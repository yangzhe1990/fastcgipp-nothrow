<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>fastcgi++: Echo</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">fastcgi++
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">index</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Echo </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="echoTutorial"></a>
Tutorial</h1>
<p>Our goal here will be to make a FastCGI application that responds to clients with an echo of all environment().data that was processed. This will include HTTP header data along with post data that was transmitted by the client. Since we want to be able to echo any alphabets, our best solution is to use UTF-32 wide characters internally and have the library code convert it to UTF-8 before sending it to the client. Your going to need the boost C++ libraries for this. At least version 1.35.0.</p>
<p>All code and data is located in the examples directory of the tarball. You'll have to compile with: <code>pkg-config &ndash;libs &ndash;cflags fastcgi++</code></p>
<h2><a class="anchor" id="echoError"></a>
Error Handling</h2>
<p>Our first step will be setting up an error logging system. Although requests can log errors directly to the HTTP server error log, I like to have an error logging system that's separate from the library when testing applications. Let's set up a function that takes a c style string and logs it to a file with a timestamp. Since everyone has access to the /tmp directory, I set it up to send error messages to /tmp/errlog. You can change it if you want to.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;boost/date_time/posix_time/posix_time.hpp&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> error_log(<span class="keyword">const</span> <span class="keywordtype">char</span>* msg)</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">using namespace </span>std;</div>
<div class="line">   <span class="keyword">using namespace </span>boost;</div>
<div class="line">   <span class="keyword">static</span> ofstream error;</div>
<div class="line">   <span class="keywordflow">if</span>(!error.is_open())</div>
<div class="line">   {</div>
<div class="line">      error.open(<span class="stringliteral">&quot;/tmp/errlog&quot;</span>, ios_base::out | ios_base::app);</div>
<div class="line">      error.imbue(locale(error.getloc(), <span class="keyword">new</span> posix_time::time_facet()));</div>
<div class="line">   }</div>
<div class="line"></div>
<div class="line">   error &lt;&lt; <span class="charliteral">&#39;[&#39;</span> &lt;&lt; posix_time::second_clock::local_time() &lt;&lt; <span class="stringliteral">&quot;] &quot;</span> &lt;&lt; msg &lt;&lt; endl;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="echoRequest"></a>
Request Handler</h2>
<p>Now we need to write the code that actually handles the request. Quite simply, all we need to do is derive from <a class="el" href="a00059.html" title="Request handling class">Fastcgipp::Request</a> and define the <a class="el" href="a00059.html#ab20544d056d5f288bca354b8c996e451" title="Response generator.">Fastcgipp::Request::response()</a> function. Since we've decided to use wide Unicode characters, we need to pass wchar_t as the template parameter to the Request class as opposed to char.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00110.html" title="Defines the Fastcgipp::Request class.">fastcgi++/request.hpp</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>HelloWorld: <span class="keyword">public</span> <a class="code" href="a00059.html" title="Request handling class">Fastcgipp::Request</a>&lt;wchar_t&gt;</div>
<div class="line">{</div>
</div><!-- fragment --><p>Now we can define our response function. It is this function that is called to generate a response for the client. It isn't a good idea to define the response() function inline as it is called from numerous spots, but for the examples readability we will make an exception.</p>
<div class="fragment"><div class="line">   <span class="keywordtype">bool</span> response()</div>
<div class="line">   {</div>
<div class="line">      <span class="keyword">using namespace </span>Fastcgipp;</div>
</div><!-- fragment --><p>First thing we need to do is output our HTTP header. Let us start with settting a cookie in the client using a Unicode string. Just to see how it echoes.</p>
<div class="fragment"><div class="line">      <span class="keywordtype">wchar_t</span> cookieString[] = { <span class="charliteral">&#39;&lt;&#39;</span>, <span class="charliteral">&#39;&quot;&#39;</span>, 0x0440, 0x0443, 0x0441, 0x0441, 0x043a, 0x0438, 0x0439, <span class="charliteral">&#39;&quot;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;;&#39;</span>, 0x0000 };</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;Set-Cookie: echoCookie=&quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca2f746f6e9c773c1d71fc9a54ea13bce2">URL</a>) &lt;&lt; cookieString &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;; path=/\n&quot;</span>;</div>
</div><!-- fragment --><p>Next of course we need to output our content type part of the header. Note the charset=utf-8. Remember that HTTP headers must be terminated with "\r\n\r\n". Not just "\n\n".</p>
<div class="fragment"><div class="line">      out &lt;&lt; <span class="stringliteral">&quot;Content-Type: text/html; charset=utf-8\r\n\r\n&quot;</span>;</div>
</div><!-- fragment --><p>Next we'll get some initial HTML stuff out of the way</p>
<div class="fragment"><div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&#39;Content-Type&#39; content=&#39;text/html; charset=utf-8&#39; /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;title&gt;fastcgi++: Echo in UTF-8&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;</span>;</div>
</div><!-- fragment --><p>Now we are ready to start outputting environment().data. We'll start with the non-post environment().data. This data is defined and initialized in the environment().object which is of type <a class="el" href="a00022.html" title="Data structure of HTTP environment data.">Fastcgipp::Http::Environment</a>.</p>
<div class="fragment"><div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;h1&gt;Environment Parameters&lt;/h1&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;&lt;b&gt;FastCGI Version:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00118.html#aeb7596e7451a1b61d58ee63539d0ab96" title="Defines the fastcgi++ version.">Protocol::version</a> &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;fastcgi++ Version:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00118.html#aeb7596e7451a1b61d58ee63539d0ab96" title="Defines the fastcgi++ version.">version</a> &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Hostname:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().host &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;User Agent:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().userAgent &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Accepted Content Types:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().acceptContentTypes &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Accepted Languages:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().acceptLanguages &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Accepted Characters Sets:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().acceptCharsets &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Referer:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().referer &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Content Type:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().contentType &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Root:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().root &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Script Name:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().scriptName &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Request URI:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().requestUri &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Request Method:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().requestMethod &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Content Length:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().contentLength &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Keep Alive Time:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().keepAlive &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Server Address:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().serverAddress &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Server Port:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().serverPort &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Client Address:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().remoteAddress &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Client Port:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().remotePort &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;If Modified Since:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().ifModifiedSince &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;/p&gt;&quot;</span>;</div>
</div><!-- fragment --><p>First we will take a look at what path info we were sent</p>
<div class="fragment"><div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;h1&gt;Path Data&lt;/h1&gt;&quot;</span>;</div>
<div class="line">      <span class="keywordflow">if</span>(environment().pathInfo.size())</div>
<div class="line">      {</div>
<div class="line">         std::wstring preTab;</div>
<div class="line">         <span class="keywordflow">for</span>(Http::Environment&lt;wchar_t&gt;::PathInfo::const_iterator it=environment().pathInfo.begin(); it!=environment().pathInfo.end(); ++it)</div>
<div class="line">         {</div>
<div class="line">            out &lt;&lt; preTab &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; *it &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">            preTab += L<span class="stringliteral">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;</span>;</div>
<div class="line">         }</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">         out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;No Path Info&lt;/p&gt;&quot;</span>;</div>
</div><!-- fragment --><p>Now let's take a look at the GET data. The GET data is stored in the associative container environment().gets which is of type std::map&lt; std::basic_string&lt; charT &gt;, std::basic_string&lt; charT &gt; &gt; links names to values.</p>
<div class="fragment"><div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;h1&gt;GET Data&lt;/h1&gt;&quot;</span>;</div>
<div class="line">      <span class="keywordflow">if</span>(environment().gets.size())</div>
<div class="line">         <span class="keywordflow">for</span>(<a class="code" href="a00022.html" title="Data structure of HTTP environment data.">Fastcgipp::Http::Environment&lt;wchar_t&gt;::Gets::const_iterator</a> it=environment().<a class="code" href="a00022.html#a209132cc52e659f68f250201b61ab68b" title="Container with all url-encoded GET data.">gets</a>.begin(); it!=environment().gets.end(); ++it)</div>
<div class="line">            out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;&quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;first &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;second &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">         out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;No GET data&lt;/p&gt;&quot;</span>;</div>
</div><!-- fragment --><p>Now let's take a look at the cookie data. The cookie data is stored in the associative container environment().cookies which is of type std::map&lt; std::basic_string&lt; charT &gt;, std::basic_string&lt; charT &gt; &gt; links names to values.</p>
<div class="fragment"><div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;h1&gt;Cookie Data&lt;/h1&gt;&quot;</span>;</div>
<div class="line">      <span class="keywordflow">if</span>(environment().cookies.size())</div>
<div class="line">         <span class="keywordflow">for</span>(<a class="code" href="a00022.html" title="Data structure of HTTP environment data.">Fastcgipp::Http::Environment&lt;wchar_t&gt;::Cookies::const_iterator</a> it=environment().<a class="code" href="a00022.html#ac863b0c8158ca9cf27e0952ea6977ad5" title="Container with all url-encoded cookie data.">cookies</a>.begin(); it!=environment().cookies.end(); ++it)</div>
<div class="line">            out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;&quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;first &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;second &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">         out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;No Cookie data&lt;/p&gt;&quot;</span>;</div>
</div><!-- fragment --><p>Next, we will make a little loop to output the post. The post data is stored in the associative container environment().posts of type <a class="el" href="a00022.html#a09b02fdcab600764176093631dc32c0b">Fastcgipp::Http::Environment::Posts</a> linking field names to <a class="el" href="a00046.html" title="Holds a piece of HTTP post data.">Fastcgipp::Http::Post</a> objects.</p>
<div class="fragment"><div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;h1&gt;Post Data&lt;/h1&gt;&quot;</span>;</div>
</div><!-- fragment --><p>If there isn't any POST data, we'll just say so</p>
<div class="fragment"><div class="line">      <span class="keywordflow">if</span>(environment().posts.size())</div>
<div class="line">         <span class="keywordflow">for</span>(<a class="code" href="a00022.html" title="Data structure of HTTP environment data.">Fastcgipp::Http::Environment&lt;wchar_t&gt;::Posts::const_iterator</a> it=environment().<a class="code" href="a00022.html#a3638c07ce8aa45905defcbd15f18e29f" title="STL container associating Post objects with their name.">posts</a>.begin(); it!=environment().posts.end(); ++it)</div>
<div class="line">         {</div>
<div class="line">            out &lt;&lt; <span class="stringliteral">&quot;&lt;h2&gt;&quot;</span> &lt;&lt; it-&gt;first &lt;&lt; <span class="stringliteral">&quot;&lt;/h2&gt;&quot;</span>;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>(it-&gt;second.type==<a class="code" href="a00046.html" title="Holds a piece of HTTP post data.">Fastcgipp::Http::Post&lt;wchar_t&gt;::form</a>)</div>
<div class="line">            {</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;&lt;b&gt;Type:&lt;/b&gt; form data&lt;br /&gt;&quot;</span>;</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Value:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;second.value &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;/p&gt;&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;&lt;b&gt;Type:&lt;/b&gt; file&lt;br /&gt;&quot;</span>;</div>
</div><!-- fragment --><p>When the post type is a file, we have some additional information</p>
<div class="fragment"><div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Filename:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;second.filename &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Content Type:&lt;/b&gt; &quot;</span> &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;second.contentType &lt;&lt; encoding(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Size:&lt;/b&gt; &quot;</span> &lt;&lt; it-&gt;second.size &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Data:&lt;/b&gt;&lt;/p&gt;&lt;pre&gt;&quot;</span>;</div>
</div><!-- fragment --><p>We will use <a class="el" href="a00026.html#ac9f1dfe834825742e6cf4d7551f22605" title="Dumps raw data directly into the FastCGI protocol.">Fastcgipp::Fcgistream::dump</a> to send the file raw data directly to the client</p>
<div class="fragment"><div class="line">               out.dump(it-&gt;second.data.get(), it-&gt;second.size);</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;/pre&gt;&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">         }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">         out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;No post data&lt;/p&gt;&quot;</span>;</div>
</div><!-- fragment --><p>And we're basically done defining our response! All we need to do is return a boolean value. Always return true if you are done. This will let apache and the manager know we are done so they can destroy the request and free it's resources. Return false if you are not finished but want to relinquish control and allow other requests to operate. You would do this if the request needed to wait for a message to be passed back to it through the task manager.</p>
<div class="fragment"><div class="line">      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">   }</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="echoManager"></a>
Requests Manager</h2>
<p>Now we need to make our main() function. Really all one needs to do is create a <a class="el" href="a00039.html" title="General task and protocol management class.">Fastcgipp::Manager</a> object with the new class we made as a template parameter, then call it's handler. Let's go one step further though and set up a try/catch loop in case we get any exceptions and log them with our error_log function.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00102.html" title="Defines the Fastcgipp::Manager class.">fastcgi++/manager.hpp</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">try</span></div>
<div class="line">   {</div>
<div class="line">      <a class="code" href="a00039.html" title="General task and protocol management class.">Fastcgipp::Manager&lt;Echo&gt;</a> fcgi;</div>
<div class="line">      fcgi.<a class="code" href="a00039.html#a578c8468166d892d1858ad6f4d953d8d" title="General handling function to be called after construction.">handler</a>();</div>
<div class="line">   }</div>
<div class="line">   <span class="keywordflow">catch</span>(std::exception&amp; e)</div>
<div class="line">   {</div>
<div class="line">      error_log(e.what());</div>
<div class="line">   }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="echoWorldCode"></a>
Full Source Code</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;boost/date_time/posix_time/posix_time.hpp&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00110.html" title="Defines the Fastcgipp::Request class.">fastcgi++/request.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="a00102.html" title="Defines the Fastcgipp::Manager class.">fastcgi++/manager.hpp</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> error_log(<span class="keyword">const</span> <span class="keywordtype">char</span>* msg)</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">using namespace </span>std;</div>
<div class="line">   <span class="keyword">using namespace </span>boost;</div>
<div class="line">   <span class="keyword">static</span> ofstream error;</div>
<div class="line">   <span class="keywordflow">if</span>(!error.is_open())</div>
<div class="line">   {</div>
<div class="line">      error.open(<span class="stringliteral">&quot;/tmp/errlog&quot;</span>, ios_base::out | ios_base::app);</div>
<div class="line">      error.imbue(locale(error.getloc(), <span class="keyword">new</span> posix_time::time_facet()));</div>
<div class="line">   }</div>
<div class="line"></div>
<div class="line">   error &lt;&lt; <span class="charliteral">&#39;[&#39;</span> &lt;&lt; posix_time::second_clock::local_time() &lt;&lt; <span class="stringliteral">&quot;] &quot;</span> &lt;&lt; msg &lt;&lt; endl;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>Echo: <span class="keyword">public</span> <a class="code" href="a00059.html" title="Request handling class">Fastcgipp::Request</a>&lt;wchar_t&gt;</div>
<div class="line">{</div>
<div class="line">   <span class="keywordtype">bool</span> response()</div>
<div class="line">   {</div>
<div class="line">      <span class="keyword">using namespace </span>Fastcgipp;</div>
<div class="line">      <span class="keywordtype">wchar_t</span> cookieString[] = { <span class="charliteral">&#39;&lt;&#39;</span>, <span class="charliteral">&#39;&quot;&#39;</span>, 0x0440, 0x0443, 0x0441, 0x0441, 0x043a, 0x0438, 0x0439, <span class="charliteral">&#39;&quot;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;;&#39;</span>, 0x0000 };</div>
<div class="line"></div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;Set-Cookie: echoCookie=&quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca2f746f6e9c773c1d71fc9a54ea13bce2">URL</a>) &lt;&lt; cookieString &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;; path=/\n&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;Content-Type: text/html; charset=utf-8\r\n\r\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&#39;Content-Type&#39; content=&#39;text/html; charset=utf-8&#39; /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;title&gt;fastcgi++: Echo in UTF-8&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;</span>;</div>
<div class="line"></div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;h1&gt;Environment Parameters&lt;/h1&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;&lt;b&gt;FastCGI Version:&lt;/b&gt; &quot;</span> &lt;&lt; Protocol::version &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;fastcgi++ Version:&lt;/b&gt; &quot;</span> &lt;&lt; version &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Hostname:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().host &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;User Agent:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().userAgent &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Accepted Content Types:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().acceptContentTypes &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Accepted Languages:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().acceptLanguages &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Accepted Characters Sets:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().acceptCharsets &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Referer:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().referer &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Content Type:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().contentType &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Root:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().root &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Script Name:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().scriptName &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Request URI:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().requestUri &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Request Method:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().requestMethod &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Content Length:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().contentLength &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Keep Alive Time:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().keepAlive &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Server Address:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().serverAddress &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Server Port:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().serverPort &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Client Address:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().remoteAddress &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Client Port:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().remotePort &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;If Modified Since:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; environment().ifModifiedSince &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;/p&gt;&quot;</span>;</div>
<div class="line"></div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;h1&gt;Path Data&lt;/h1&gt;&quot;</span>;</div>
<div class="line">      <span class="keywordflow">if</span>(environment().pathInfo.size())</div>
<div class="line">      {</div>
<div class="line">         std::wstring preTab;</div>
<div class="line">         <span class="keywordflow">for</span>(<a class="code" href="a00022.html" title="Data structure of HTTP environment data.">Http::Environment&lt;wchar_t&gt;::PathInfo::const_iterator</a> it=environment().<a class="code" href="a00022.html#a5d03cfd8987c6e8dbfcc89138f19be79">pathInfo</a>.begin(); it!=environment().pathInfo.end(); ++it)</div>
<div class="line">         {</div>
<div class="line">            out &lt;&lt; preTab &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; *it &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">            preTab += L<span class="stringliteral">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;</span>;</div>
<div class="line">         }</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">         out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;No Path Info&lt;/p&gt;&quot;</span>;</div>
<div class="line"></div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;h1&gt;GET Data&lt;/h1&gt;&quot;</span>;</div>
<div class="line">      <span class="keywordflow">if</span>(environment().gets.size())</div>
<div class="line">         <span class="keywordflow">for</span>(<a class="code" href="a00022.html" title="Data structure of HTTP environment data.">Http::Environment&lt;wchar_t&gt;::Gets::const_iterator</a> it=environment().<a class="code" href="a00022.html#a209132cc52e659f68f250201b61ab68b" title="Container with all url-encoded GET data.">gets</a>.begin(); it!=environment().gets.end(); ++it)</div>
<div class="line">            out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;&quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;first &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;second &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">         out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;No GET data&lt;/p&gt;&quot;</span>;</div>
<div class="line">      </div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;h1&gt;Cookie Data&lt;/h1&gt;&quot;</span>;</div>
<div class="line">      <span class="keywordflow">if</span>(environment().cookies.size())</div>
<div class="line">         <span class="keywordflow">for</span>(<a class="code" href="a00022.html" title="Data structure of HTTP environment data.">Http::Environment&lt;wchar_t&gt;::Cookies::const_iterator</a> it=environment().<a class="code" href="a00022.html#ac863b0c8158ca9cf27e0952ea6977ad5" title="Container with all url-encoded cookie data.">cookies</a>.begin(); it!=environment().cookies.end(); ++it)</div>
<div class="line">            out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;&quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;first &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;second &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">         out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;No Cookie data&lt;/p&gt;&quot;</span>;</div>
<div class="line"></div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;h1&gt;POST Data&lt;/h1&gt;&quot;</span>;</div>
<div class="line">      <span class="keywordflow">if</span>(environment().posts.size())</div>
<div class="line">      {</div>
<div class="line">         <span class="keywordflow">for</span>(<a class="code" href="a00022.html" title="Data structure of HTTP environment data.">Http::Environment&lt;wchar_t&gt;::Posts::const_iterator</a> it=environment().<a class="code" href="a00022.html#a3638c07ce8aa45905defcbd15f18e29f" title="STL container associating Post objects with their name.">posts</a>.begin(); it!=environment().posts.end(); ++it)</div>
<div class="line">         {</div>
<div class="line">            out &lt;&lt; <span class="stringliteral">&quot;&lt;h2&gt;&quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;first &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;/h2&gt;&quot;</span>;</div>
<div class="line">            <span class="keywordflow">if</span>(it-&gt;second.type==<a class="code" href="a00046.html" title="Holds a piece of HTTP post data.">Http::Post&lt;wchar_t&gt;::form</a>)</div>
<div class="line">            {</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;&lt;b&gt;Type:&lt;/b&gt; form data&lt;br /&gt;&quot;</span>;</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Value:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;second.value &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;/p&gt;&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">            </div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;&lt;b&gt;Type:&lt;/b&gt; file&lt;br /&gt;&quot;</span>;</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Filename:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;second.filename &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Content Type:&lt;/b&gt; &quot;</span> &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca42e00febc19b44c59cfdde409c8a7cb6">HTML</a>) &lt;&lt; it-&gt;second.contentType &lt;&lt; <a class="code" href="a00020.html" title="Stream manipulator for setting output encoding.">encoding</a>(<a class="code" href="a00118.html#a3bfe00c3bd74edb08bb2efd5f4a3714ca1824f8debfcb8164867fd6a229a017a2">NONE</a>) &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Size:&lt;/b&gt; &quot;</span> &lt;&lt; it-&gt;second.size &lt;&lt; <span class="stringliteral">&quot;&lt;br /&gt;&quot;</span>;</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;b&gt;Data:&lt;/b&gt;&lt;/p&gt;&lt;pre&gt;&quot;</span>;</div>
<div class="line">               out.dump(it-&gt;second.data.get(), it-&gt;second.size);</div>
<div class="line">               out &lt;&lt; <span class="stringliteral">&quot;&lt;/pre&gt;&quot;</span>;</div>
<div class="line">            }</div>
<div class="line">         }</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">         out &lt;&lt; <span class="stringliteral">&quot;&lt;p&gt;No POST data&lt;/p&gt;&quot;</span>;</div>
<div class="line"></div>
<div class="line">      out &lt;&lt; <span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>;</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">   }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// The main function is easy to set up</span></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">try</span></div>
<div class="line">   {</div>
<div class="line">      <a class="code" href="a00039.html" title="General task and protocol management class.">Fastcgipp::Manager&lt;Echo&gt;</a> fcgi;</div>
<div class="line">      fcgi.<a class="code" href="a00039.html#a578c8468166d892d1858ad6f4d953d8d" title="General handling function to be called after construction.">handler</a>();</div>
<div class="line">   }</div>
<div class="line">   <span class="keywordflow">catch</span>(std::exception&amp; e)</div>
<div class="line">   {</div>
<div class="line">      error_log(e.what());</div>
<div class="line">   }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 22 2012 20:35:53 for fastcgi++ by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1
</small></address>
</body>
</html>
